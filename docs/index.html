<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ECHR Case Law ‚Äî Paragraph-Level Search</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Source+Serif+4:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="assets/dashboard.css">
  <link rel="stylesheet" href="assets/search-app.css">
</head>
<body>
  <nav class="navbar">
    <div class="nav-container">
      <a href="./" class="nav-brand">
        <span class="brand-icon">‚öñÔ∏è</span>
        <span class="brand-text">ECHR Search</span>
      </a>
      <div class="nav-links">
        <a href="./" class="nav-link active">Search</a>
        <a href="analytics.html" class="nav-link">Statistics</a>
      </div>
      <button class="theme-toggle" id="themeToggle" type="button" title="Toggle dark mode" aria-label="Toggle dark mode">
        <span class="theme-icon-light">‚òÄÔ∏è</span>
        <span class="theme-icon-dark">üåô</span>
      </button>
    </div>
  </nav>

  <main class="main-content">
    <section class="hero">
      <div class="hero-inner">
        <h1 class="hero-title">European Court of Human Rights</h1>
        <p class="hero-subtitle">Search through judicial decisions at the paragraph level</p>

        <section class="data-source-panel" aria-labelledby="dataSourceTitle">
          <h2 id="dataSourceTitle" class="data-source-title">Data Source</h2>
          <p class="data-source-subtitle">Choose one option to start: load sample dataset (50 decisions) or upload your own JSONL file.</p>

          <div class="source-actions">
            <button type="button" id="loadSampleBtn" class="source-btn">Load Sample Dataset (50)</button>
            <label class="source-upload-btn" for="fileInput">Choose JSONL File</label>
            <button type="button" id="openClassifierBtn" class="source-btn" disabled>Open Classifier</button>
            <input id="fileInput" type="file" accept=".jsonl,application/json,text/plain" hidden>
          </div>

          <div id="dropZone" class="drop-zone" tabindex="0" role="button" aria-label="Drop JSONL file here or click to choose one">
            Drag and drop your `.jsonl` file here
          </div>

          <p id="datasetStatus" class="dataset-status">No dataset loaded yet.</p>
          <p id="datasetMeta" class="dataset-note">Dataset: not selected</p>
          <p id="classifierResumeNote" class="dataset-note hidden">Classifier progress: not loaded</p>
        </section>

        <form id="searchForm" class="search-form search-disabled">
          <div class="search-box">
            <input
              type="text"
              id="searchInput"
              class="search-input"
              placeholder='Search paragraphs... e.g. "right to privacy" OR surveillance'
              autocomplete="off"
              disabled
            >
            <button type="submit" class="search-btn" id="searchBtn" disabled>Search</button>
          </div>

          <div class="search-tips">
            <span class="tip">Use <code>"quotes"</code> for exact phrases</span>
            <span class="tip-sep">¬∑</span>
            <span class="tip">Use <code>OR</code> between alternatives</span>
            <span class="tip-sep">¬∑</span>
            <span class="tip">Multiple words = AND logic</span>
            <span class="tip-sep">¬∑</span>
            <span class="tip">Metadata prefixes: <code>case:</code>, <code>ecli:</code>, <code>article:</code>, <code>state:</code>, <code>body:</code>, <code>judge:</code></span>
          </div>

          <button type="button" class="filter-toggle" id="filterToggleBtn" aria-expanded="false" disabled>
            <span class="filter-toggle-icon">‚ñº</span> Advanced Filters
          </button>

          <div class="filters-panel" id="filtersPanel">
            <div class="filters-grid">
              <div class="filter-group">
                <h3 class="filter-title">Case Sections</h3>
                <div class="checkbox-grid compact" id="sectionsFilters"></div>
              </div>

              <div class="filter-group">
                <h3 class="filter-title">Respondent State</h3>
                <div class="checkbox-grid scrollable" id="countriesFilters"></div>
              </div>

              <div class="filter-group">
                <h3 class="filter-title">Convention Articles</h3>
                <div class="checkbox-grid scrollable" id="articlesFilters"></div>
              </div>

              <div class="filter-group">
                <h3 class="filter-title">Originating Body</h3>
                <div class="checkbox-grid scrollable" id="originatingBodyFilters"></div>
              </div>

              <div class="filter-group">
                <h3 class="filter-title">Importance</h3>
                <div class="checkbox-grid compact" id="importanceFilters"></div>
              </div>

              <div class="filter-group">
                <h3 class="filter-title">Outcome</h3>
                <div class="checkbox-grid compact" id="outcomeFilters"></div>

                <h3 class="filter-title inline-space">Procedural Outcome</h3>
                <div class="checkbox-grid compact" id="legalOutcomeFilters">
                  <label class="cb-label"><input type="checkbox" data-name="legalOutcomes" value="has_inadmissibility" disabled> <span>Inadmissibility</span></label>
                  <label class="cb-label"><input type="checkbox" data-name="legalOutcomes" value="is_struck_out" disabled> <span>Struck out</span></label>
                </div>

                <h3 class="filter-title inline-space">Separate Opinion</h3>
                <div class="checkbox-grid compact" id="separateOpinionFilters"></div>
              </div>

              <div class="filter-group">
                <h3 class="filter-title">Metadata Presence</h3>
                <div class="checkbox-grid compact" id="presenceFilters">
                  <label class="cb-label"><input type="checkbox" data-name="presence" value="has_strasbourg_caselaw" disabled> <span>Has Strasbourg citations</span></label>
                  <label class="cb-label"><input type="checkbox" data-name="presence" value="has_domestic_law" disabled> <span>Has domestic law</span></label>
                  <label class="cb-label"><input type="checkbox" data-name="presence" value="has_international_law" disabled> <span>Has international law</span></label>
                  <label class="cb-label"><input type="checkbox" data-name="presence" value="has_rules_of_court" disabled> <span>Has rules of court</span></label>
                </div>

                <h3 class="filter-title inline-space">Keyword Filter</h3>
                <input type="text" id="keywordFilterInput" class="search-input compact" placeholder="e.g. proportionality" disabled>

                <h3 class="filter-title inline-space">Cites Precedent</h3>
                <input type="text" id="precedentFilterInput" class="search-input compact" placeholder="e.g. Magyar Helsinki Bizotts√°g" disabled>
              </div>

              <div class="filter-group">
                <h3 class="filter-title">Judgment Date</h3>
                <div class="date-range">
                  <input type="date" id="dateFrom" class="date-input" disabled>
                  <span class="date-sep">to</span>
                  <input type="date" id="dateTo" class="date-input" disabled>
                </div>

                <h3 class="filter-title inline-space">Chamber</h3>
                <div class="checkbox-grid compact" id="chamberFilters">
                  <label class="cb-label"><input type="checkbox" value="CHAMBER" disabled> <span>Chamber</span></label>
                  <label class="cb-label"><input type="checkbox" value="GRANDCHAMBER" disabled> <span>Grand Chamber</span></label>
                  <label class="cb-label"><input type="checkbox" value="OTHER" disabled> <span>Other</span></label>
                </div>
              </div>
            </div>
          </div>
        </form>
      </div>
    </section>

    <section class="stats-bar">
      <div class="stats-bar-inner">
        <div class="stat-chip">
          <span class="stat-value" id="statTotalCases">-</span>
          <span class="stat-label">Cases</span>
        </div>
        <div class="stat-chip">
          <span class="stat-value" id="statTotalParagraphs">-</span>
          <span class="stat-label">Paragraphs</span>
        </div>
        <div class="stat-chip">
          <span class="stat-value" id="statTotalCountries">-</span>
          <span class="stat-label">Countries</span>
        </div>
        <div class="stat-chip">
          <span class="stat-value" id="statDateRange">-</span>
          <span class="stat-label">Date Range</span>
        </div>
      </div>
    </section>

    <div class="results-layout">
      <div class="results-main">
        <div class="results-header" id="resultsHeader" hidden>
          <form id="inlineSearchForm" class="inline-search">
            <input type="text" id="inlineSearchInput" class="search-input compact" placeholder="Search paragraphs..." disabled>
            <button type="submit" class="search-btn compact" id="inlineSearchBtn" disabled>Search</button>
          </form>
          <div class="results-meta">
            <span class="meta-count"><strong id="resultsHits">0</strong> paragraphs in <strong id="resultsCases">0</strong> cases</span>
            <span class="meta-time" id="resultsTime">(0.000s)</span>
            <button type="button" class="export-btn" id="cardModeBtn" title="Toggle compact/detailed case cards" disabled>Detailed view</button>
            <button type="button" class="export-btn" id="exportBtn" title="Export results to CSV" disabled>üì• Export CSV</button>
            <label class="export-option"><input type="checkbox" id="exportIncludeClassifier" disabled> Include classifier labels</label>
            <button type="button" class="export-btn" id="classifierQuickOpenBtn" title="Open classifier panel" disabled>üè∑Ô∏è Classifier</button>
            <button type="button" class="export-btn clear-btn" id="clearBtn" title="Clear current search" disabled>Clear</button>
          </div>
          <div class="active-filters" id="activeFilters"></div>
        </div>

        <div class="no-results" id="noResults" hidden>
          <div class="no-results-icon">üîç</div>
          <h2>No results found</h2>
          <p>Try different search terms, broader filters, or check your spelling.</p>
          <a href="#" class="back-link" id="backToSearch">‚Üê Back to search</a>
        </div>

        <div class="cases-list" id="casesList"></div>
        <div class="pagination" id="pagination" hidden></div>
      </div>

      <aside class="results-sidebar" id="sidebar">
        <h3 class="sidebar-title">Search Analytics</h3>

        <div class="sidebar-section">
          <h4>Convention Articles</h4>
          <div class="bar-list" id="analyticsArticles"></div>
        </div>

        <div class="sidebar-section">
          <h4>Respondent States</h4>
          <div class="bar-list" id="analyticsCountries"></div>
        </div>

        <div class="sidebar-section">
          <h4>Sections</h4>
          <div class="bar-list" id="analyticsSections"></div>
        </div>

        <div class="sidebar-section">
          <h4>Originating Body</h4>
          <div class="bar-list" id="analyticsBodies"></div>
        </div>

        <div class="sidebar-section">
          <h4>Importance</h4>
          <div class="bar-list" id="analyticsImportance"></div>
        </div>

        <div class="sidebar-section">
          <h4>Outcomes</h4>
          <div class="bar-list" id="analyticsOutcomes"></div>
        </div>

        <div class="sidebar-section">
          <h4>Frequent Terms</h4>
          <div class="word-cloud" id="analyticsWords"></div>
        </div>
      </aside>
    </div>
  </main>

  <footer class="footer">
    <div class="footer-container">
      <span>ECHR Case Law Database ‚Äî Paragraph-Level Search</span>
    </div>
  </footer>

  <div class="modal" id="caseModal" hidden>
    <div class="modal-backdrop" data-close-modal="true"></div>
    <div class="modal-panel">
      <div class="modal-header">
        <h2 id="modalTitle">Case</h2>
        <button type="button" id="closeModal" class="modal-close" aria-label="Close">√ó</button>
      </div>
      <div class="modal-meta" id="modalMeta"></div>

      <div class="modal-tools">
        <input type="text" id="modalQuery" class="modal-input" placeholder="Search within this judgment">
        <select id="modalSectionFilter" class="modal-select">
          <option value="all">All sections</option>
        </select>
        <span id="modalCount" class="modal-count"></span>
      </div>

      <div id="modalBody" class="modal-body"></div>
    </div>
  </div>

  <div class="classifier-pane" id="classifierPane">
    <div class="classifier-pane-header">
      <h2>üè∑Ô∏è Experimental Paragraph Tagging</h2>
      <button type="button" id="closeClassifierBtn" class="classifier-pane-close" aria-label="Close classifier">√ó</button>
    </div>

    <div class="classifier-pane-body">
      <section class="classifier-section">
        <h3><span class="step-number">1</span> Labels</h3>
        <p class="classifier-help">Define your own labels. You can assign multiple labels to one paragraph.</p>
        <div class="classifier-row">
          <input type="text" id="newClassifierLabelInput" placeholder="New label name" class="classifier-input">
          <button type="button" id="addClassifierLabelBtn" class="classifier-btn primary">Add</button>
        </div>
        <div id="classifierLabelsList" class="classifier-chip-list"></div>
      </section>

      <section class="classifier-section">
        <h3><span class="step-number">2</span> Training Sample</h3>
        <p class="classifier-help">Select sections for sampling. Training sample size is fixed at 30 paragraphs.</p>
        <div id="classifierTrainingSections" class="classifier-check-grid"></div>
        <div class="classifier-row">
          <button type="button" id="refreshClassifierSampleBtn" class="classifier-btn secondary">Generate / Refresh Sample (30)</button>
        </div>
        <div class="classifier-sample-nav">
          <button type="button" id="classifierPrevSampleBtn" class="classifier-btn secondary">‚Üê Prev</button>
          <span id="classifierSampleCounter">No sample loaded</span>
          <button type="button" id="classifierNextSampleBtn" class="classifier-btn secondary">Next ‚Üí</button>
        </div>
        <div id="classifierSampleCard" class="classifier-sample-card">
          <p class="classifier-empty">Generate sample first.</p>
        </div>
      </section>

      <section class="classifier-section">
        <h3><span class="step-number">3</span> Train And Predict</h3>
        <p class="classifier-warning">Experimental support only: model tags are assistive and can be legally inaccurate. Always verify against full judgment text and HUDOC.</p>
        <div class="classifier-method-row">
          <label for="classifierMethod" class="classifier-method-label">Classifier Method</label>
          <select id="classifierMethod" class="classifier-select">
            <option value="tfidf_centroid">TF-IDF Centroid (Balanced)</option>
            <option value="char_ngram_centroid">Char N-Gram Centroid (Short Text)</option>
            <option value="keyword_overlap">Keyword Overlap (Fast, Interpretable)</option>
          </select>
          <p id="classifierMethodHint" class="classifier-help">Balanced precision/recall using word TF-IDF centroids.</p>
        </div>
        <div class="classifier-row">
          <label class="classifier-threshold-label" for="classifierThresholdRange">Threshold</label>
          <input type="range" id="classifierThresholdRange" min="0.05" max="0.8" step="0.01" value="0.22">
          <span id="classifierThresholdValue" class="classifier-threshold-value">0.22</span>
        </div>
        <p class="classifier-help">Higher threshold means fewer but stricter model suggestions.</p>
        <div class="classifier-row">
          <button type="button" id="trainClassifierBtn" class="classifier-btn primary">Train Model</button>
        </div>
        <p id="classifierModelStatus" class="classifier-help">Model not trained yet.</p>

        <h4 class="classifier-subtitle">Tag Sections With Model</h4>
        <div id="classifierPredictionSections" class="classifier-check-grid"></div>
        <div class="classifier-row">
          <button type="button" id="applyClassifierModelBtn" class="classifier-btn success">Apply Model To Selected Sections</button>
        </div>
      </section>

      <section class="classifier-section">
        <h3><span class="step-number">4</span> Save Progress</h3>
        <p class="classifier-help">Progress is auto-saved in browser local storage per dataset. You can also export/import a backup file.</p>
        <div class="classifier-row">
          <button type="button" id="exportClassifierProgressBtn" class="classifier-btn secondary">Export Progress JSON</button>
          <label for="importClassifierProgressInput" class="classifier-import-label">Import Progress JSON</label>
          <input id="importClassifierProgressInput" type="file" accept=".json,application/json" hidden>
        </div>
        <div class="classifier-row">
          <button type="button" id="clearClassifierProgressBtn" class="classifier-btn danger">Clear Classifier Progress</button>
        </div>
        <p id="classifierPersistStatus" class="classifier-help">No saved state loaded.</p>
      </section>
    </div>
  </div>

  <div class="classifier-backdrop" id="classifierBackdrop" hidden></div>

  <script src="assets/search-app.js"></script>
</body>
</html>
